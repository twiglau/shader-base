# 游戏引擎的渲染队列:  
1. 普通情况下, 绘制画面, 先绘制最远处的, 然后一层一层,到最近的物体;  
2. 3D为了优化,反过来进行; 先绘制距离摄像机的最近的(片元), 然后再绘制较远的; 先绘制的物体, 我们会把这个颜色,写入`颜色缓存区`里面; `深度缓存区`, 我们这个片元的深度是最浅的;
> 解释:
> 1.`ZTest[深度测试]`: 绘制物体的片元的时候, 我们先到深度缓冲区里面,去比较; 确认`绘制的片元` 与深度缓冲区里 `最近的片元`比较. 如果比 `最近的片元`还要近, 那么就绘制将要 `绘制的片元`, 把颜色输出到 `颜色缓冲区`; 如果比 `最近的片元`远, 那么就不绘制; => `深度比较`;
> 2.`ZWrite`: 如果这个片元绘制了, 我们就把这个片元的深度,写入到深度缓冲区里面;
>> ZWrite解释: 假设你通过了深度测试, 你也把颜色写入到了颜色缓存区, Zwrite-就是 是不是把你这个片元的深度信息更新到了深度缓冲区里面;
>> ZWrite 可以做一个开关控制;

3. 采用`2`中的方案,会产生一些问题:
> 比如-绘制透明物体,没有办法把透明物体,和非透明的物体放在一起绘制;
> 根据摄像机看到的最近的物体先绘制;如果最近物体是半透明的,理应能看到后面的物体; 但是绘制时直接丢弃后面的物体;

4. 如何解决 `3`中产生的问题? - `渲染队列(Render Queue)` 
* 绘制机制-描述;
```
A队列: ID-1000: 物体A1, 物体A2
B队列: ID-2000: 物体B1, 物体B2, 物体B3
C队列: ID-3000: 物体C1, 物体C2, 
D队列: ID-4000: 物体D1, 物体D2
```  
> 游戏场景的物体: 先根据物体的队列,来放置;
> 游戏引擎绘制物体的时候, 也是一个个队列来绘制的:顺序由小及大;
```
A队列的物体 -> A队列的物体 -> 颜色缓存区;
B队列物体 -> B队列 -> 物体 -> 颜色缓存去;
...
```  

5. 案例:  - 深度测试: 同一个队列而言
> 1. 场景: 摄像机看到 物体A[半透明]- 绿色, 物体B在物体A的后面 - 蓝色;
> 2. 更改物体B的 `Render Queue`: 2000; 物体A的`Render Queue`:3000;
> 3. 结果:
>> A位于3000的队列;
>> B位于2000的队列;
>> 先绘制2000队列:  `颜色缓存`: 片元 (x,y)-蓝色, `深度缓存`: 片元(x,y)-> z; => 对应片元1 [B];
>> 再绘制3000队列: 也是一个物体,不用比较,能够绘制; 但是因为有透明度,会携带 -> (x, y) alpha颜色 -> 也写入到颜色缓存; 那么就混合了原来蓝色[B], 原来的颜色缓存是蓝色;

6. 总结:  
* ZTest: 深度测试, 就是在对一个片元着色之前, 通过深度测试,才着色;
* ZTest 参数:-举例
> Always: 永远通过, 片元的颜色 => 输入到颜色缓存区;
> NEVER: 片元的颜色,无法输入到缓存区;
> LESS: 距离摄像机越近的, 就通过测试;
* ZWrite: 是否要把我们的深度信息更新到 `深度缓存区` 里面;
> 在 `5.案例` 中, 使用 `LESS`比较策略; 物体B 深度要大于 物体A;
>> 假设 A, z(深度) 100, B, z(深度)为 150; 
>>> 1. 物体A --> 片元 --> (ZTest 通过) 颜色 -> 写入到: 颜色缓存;  接着如果 ZWrite = On, 那么A的深度 -> 写入到: 深度缓存;
>>> 2. 接着B 按照以上方式, (ZTest 通过) B颜色 => 也会写入到: 颜色缓存; 接着如果 ZWrite 为On, B的深度信息也会写入到 深度缓存. => 通过比较,就会只能看到 A, 而看不到B; 如果 ZWrite 为Off => 因为B颜色写入了 颜色缓存, 而 ZWrite为Off,没有更新深度信息,深度信息没有更新,B就能通过深度测试. 结果为:也能看到B, 并且B位于A的前面;  

7. 混合(Blend): 颜色 -> 到 颜色缓存区目标颜色 -> 混合;
* 颜色写入颜色缓存的时候, 要配置混合模式 - blend模式;
* Blend 有几种混合方式:  
> 直接覆盖; 
> 透明度混合;  
```
// 源颜色 + 目标颜色 (1 - 源)
Blend SrcAlpha OneMinusSrcAlpha  
30%绿色 + 70%缓存颜色
``` 
> blend模式:  
```
正常Alpha混合模式
Blend SrcAlpha OneMinusSrcAlpha 

正片叠底 相乘Multiply
Blend DstColor Zero 

线性叠加
Blend One One  

Darken 变暗
Blend Op Min 

Lighten 变亮
Blend Op Max

Screen 滤色
Blend OneMinusDstColor One 或者
Blend One OneMinusSrcColor

.....
```  


